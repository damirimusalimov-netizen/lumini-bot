# Lumini-bot — минимальный проект (бот + сервер + products.json)

Это минимальный рабочий набор файлов, который:
- слушает посты в вашем канале Telegram (через Bot API и polling),
- превращает посты с фото+подписью в товары,
- сохраняет товары в `products.json`,
- отдаёт `products.json` через HTTP (endpoint `/products.json`) — ваш сайт подгружает его и показывает каталог.

---
## Что внутри папки
- `package.json` — зависимости и команда `npm start`
- `bot.js` — основной код бота и сервера
- `products.json` — пример с 2 товарами
- `fetchProducts.js` — скрипт для вставки в ваш `index.html` (подгружает и рендерит товары)
- `.gitignore` — (опционально, может быть добавлен вручную)

---
## Быстрая инструкция (для чайника)

### 1) Создать бота и получить токен
1. Откройте Telegram и начните чат с **@BotFather**.
2. Отправьте `/newbot` и следуйте подсказкам. В конце вы получите **BOT TOKEN** (строка вида `123456789:ABC...`).

### 2) Добавить бота в ваш канал как администратора
1. Откройте канал `@LuminiShop`.
2. `Управление каналом` → `Администраторы` → `Добавить администратора`.
3. Найдите бота по имени (оно заканчивается на `bot`) и добавьте его.
4. Важно: **Отключите «Оставаться анонимным»** для бота (иначе бот не будет получать события channel_post).
5. Боту достаточно прав на чтение/публикацию (не нужно давать полный контроль).

### 3) Развернуть на Render или Railway (самый простой способ)
1. Создайте репозиторий на GitHub и загрузите туда файлы этой папки.
2. На Render / Railway создайте новый сервис (Web Service) и подключите репозиторий.
3. В настройках сервиса задайте переменные окружения:
   - `BOT_TOKEN` = ваш токен от BotFather
   - `CHANNEL_USERNAME` = LuminiShop  (без `@`) — по умолчанию уже стоит
4. Запустите деплой. Сервис будет слушать на порту, который предоставляет платформа (используется `process.env.PORT`).
5. После деплоя у вас появится URL, например `https://lumini-bot.onrender.com`.
   Полный путь к JSON: `https://lumini-bot.onrender.com/products.json`

### 4) Подключить к сайту
1. В `index.html` (вашего сайта) вставьте перед `</body>`:

```html
<script>
// вариант 1: задать переменную с URL и подключить скрипт
window.PRODUCTS_JSON_URL = 'https://lumini-bot.onrender.com/products.json';
</script>
<script src="/path/to/fetchProducts.js"></script>
```

Или просто откройте `fetchProducts.js`, замените `https://YOUR_DOMAIN/products.json` на реальный URL и подключите.

### 5) Как публиковать товары в канале (формат подписи)
Пиши в канале пост с фото и подписью в таком виде:

```
Название товара
Цена: 2500
Категория: krossovki
```

- **Первая строка** — будет именем товара.
- Строка, содержащая `Цена` (регистронезависимо) — будет обработана.
- Строка `Категория` — определит поле `category`.
- Если отсутствует цена или категория — используются значения по умолчанию.

### 6) Тестирование локально (опционально)
1. Установите Node.js (версия >=16).
2. В папке проекта выполните:
   ```
   npm install
   BOT_TOKEN=YOUR_TOKEN node bot.js
   ```
3. Откройте `http://localhost:3000/products.json` — вы должны увидеть `products.json`.
4. Если бот добавлен в канал и вы опубликуете пост с фото+подписью — `products.json` обновится.

---
## Советы и возможные улучшения
- Сейчас используется polling. Для больших проектов лучше настроить webhook.
- Можно добавлять удаление/редактирование товаров при удалении/редактировании поста (требует обработки других событий).
- Защитить API или выдавать только нужные поля — если нужно.

---
Если хочешь, я автоматически запакую эту папку в zip и дам ссылку для скачивания — готово.
